# Phase 1 systems benchmark config
# 2P EP-PBS SD-CFR with profiling enabled for pipeline validation.
# Derived from runs/eppbs-2p/config.yaml.

system:
  recursion_limit: 10000

cfr_training:
  num_iterations: 120
  save_interval: 25
  pruning_enabled: true
  pruning_threshold: 1.0e-6
  exploitability_interval: 100
  exploitability_interval_seconds: 7200
  num_workers: 1

cfr_plus_params:
  weighted_averaging_enabled: true
  averaging_delay: 100

agent_params:
  memory_level: 1
  time_decay_turns: 3

cambia_rules:
  allowDrawFromDiscardPile: false
  allowReplaceAbilities: false
  snapRace: false
  penaltyDrawCount: 2
  use_jokers: 2
  cards_per_player: 4
  initial_view_count: 2
  cambia_allowed_round: 0
  allowOpponentSnapping: false
  max_game_turns: 46
  lockCallerHand: true

persistence:
  agent_data_save_path: "runs/sys-bench/checkpoints/deep_cfr_checkpoint.pt"

agents:
  greedy_agent:
    cambia_call_threshold: 5

analysis:
  exploitability_num_workers: 0

deep_cfr:
  hidden_dim: 256
  dropout: 0.1
  learning_rate: 0.001
  batch_size: 4096
  train_steps_per_iteration: 1000
  alpha: 1.5
  traversals_per_step: 333
  advantage_buffer_capacity: 2000000
  strategy_buffer_capacity: 2000000
  save_interval: 25
  device: "auto"
  sampling_method: "outcome"
  traversal_method: "outcome"
  traversal_depth_limit: 0
  max_tasks_per_child: "auto"
  worker_memory_budget_pct: 0.10
  exploration_epsilon: 0.6
  engine_backend: "go"
  pipeline_training: true
  use_amp: false
  use_compile: false
  validate_inputs: false
  es_validation_interval: 25
  es_validation_depth: 10
  es_validation_traversals: 500
  # SD-CFR settings
  use_sd_cfr: true
  sd_cfr_max_snapshots: 200
  sd_cfr_snapshot_weighting: "linear"
  # Residual network settings
  num_hidden_layers: 3
  use_residual: true
  # EMA serving weights for O(1) inference
  use_ema: true
  # EP-PBS encoding (200-dim)
  encoding_mode: "ep_pbs"
  # Profiling
  enable_traversal_profiling: true

logging:
  log_level_file: "INFO"
  log_level_console: "INFO"
  log_dir: "runs/sys-bench/logs"
  log_file_prefix: "cambia"
  log_max_bytes: "10MB"
  log_backup_count: 5
  log_size_update_interval_sec: 60
  worker_config:
    default_level: "WARNING"
    sequential_rules: []
    overrides: []
  log_archive_enabled: true
  log_archive_max_archives: 0
  log_archive_dir: ""
  log_simulation_traces: false
  simulation_trace_filename_prefix: "simulation_traces"
